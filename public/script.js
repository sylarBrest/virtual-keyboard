(()=>{"use strict";console.log("Virtual Keyboard task started"),(new class{constructor(){this.elements={main:null,textarea:null,keyboardContainer:null,keys:[]},this.properties={isCapsLock:!1,isShiftPressed:!1,isCtrlPressed:!1,isAltPressed:!1,isLangSwitched:!1,lang:"en"},this.layouts={en:["`","1","2","3","4","5","6","7","8","9","0","-","=","backspace","tab","q","w","e","r","t","y","u","i","o","p","[","]","\\","del","capslock","a","s","d","f","g","h","j","k","l",";","'","enter","leftshift","z","x","c","v","b","n","m",",",".","/","uparrow","rightshift","leftctrl","win","leftalt","spacebar","rightalt","leftarrow","downarrow","rightarrow","rightctrl"],enShift:["~","!","@","#","$","%","^","&","*","(",")","_","+","backspace","tab","Q","W","E","R","T","Y","U","I","O","P","{","}","|","del","capslock","A","S","D","F","G","H","J","K","L",":",'"',"enter","leftshift","Z","X","C","V","B","N","M","<",">","?","uparrow","rightshift","leftctrl","win","leftalt","spacebar","rightalt","leftarrow","downarrow","rightarrow","rightctrl"],ru:["ё","1","2","3","4","5","6","7","8","9","0","-","=","backspace","tab","й","ц","у","к","е","н","г","ш","щ","з","х","ъ","\\","del","capslock","ф","ы","в","а","п","р","о","л","д","ж","э","enter","leftshift","я","ч","с","м","и","т","ь","б","ю",".","uparrow","rightshift","leftctrl","win","leftalt","spacebar","rightalt","leftarrow","downarrow","rightarrow","rightctrl"],ruShift:["Ё","!",'"',"№",";","%",":","?","*","(",")","_","+","backspace","tab","Й","Ц","У","К","Е","Н","Г","Ш","Щ","З","Х","Ъ","/","del","capslock","Ф","Ы","В","А","П","Р","О","Л","Д","Ж","Э","enter","leftshift","Я","Ч","С","М","И","Т","Ь","Б","Ю",",","uparrow","rightshift","leftctrl","win","leftalt","spacebar","rightalt","leftarrow","downarrow","rightarrow","rightctrl"]}}init(){this.elements.main=document.createElement("main"),this.elements.main.classList.add("main"),this.elements.main.classList.add("main-container"),this.elements.textarea=document.createElement("textarea"),this.elements.textarea.classList.add("textarea"),this.elements.textarea.setAttribute("autofocus","autofocus"),this.elements.textarea.setAttribute("rows","10"),this.elements.textarea.setAttribute("cols","62"),this.elements.keyboardContainer=document.createElement("div"),this.elements.keyboardContainer.classList.add("keyboard"),this.elements.keys=this.elements.keyboardContainer.querySelectorAll(".key"),this.render()}createKeys(){const e=document.createDocumentFragment(),t=this.layouts[this.properties.lang],s=e=>`<span class="material-icons">${e}</span>`;return t.forEach((t=>{const r=document.createElement("button");switch(r.setAttribute("type","button"),r.classList.add("key"),t){case"del":r.classList.add("text"),r.innerHTML="del";break;case"leftctrl":case"rightctrl":r.classList.add("text"),r.textContent="ctrl";break;case"leftalt":case"rightalt":r.classList.add("text"),r.textContent="alt";break;case"backtick":r.classList.add("symbol"),r.textContent="`";break;case"tab":r.innerHTML=s("keyboard_tab");break;case"win":r.innerHTML=s("window");break;case"uparrow":r.innerHTML=s("keyboard_arrow_up");break;case"leftarrow":r.innerHTML=s("keyboard_arrow_left");break;case"downarrow":r.innerHTML=s("keyboard_arrow_down");break;case"rightarrow":r.innerHTML=s("keyboard_arrow_right");break;case"backspace":r.classList.add("wide"),r.innerHTML=s("keyboard_backspace");break;case"capslock":r.classList.add("wide"),r.innerHTML=s("keyboard_capslock");break;case"enter":r.classList.add("wide"),r.innerHTML=s("keyboard_return");break;case"leftshift":case"rightshift":r.classList.add("wide"),r.classList.add("shift"),r.innerHTML=s("publish");break;case"spacebar":r.classList.add("ultrawide"),r.innerHTML=s("space_bar");break;default:r.classList.add("symbol"),r.innerHTML=t}r.setAttribute("data-key",t),r.addEventListener("click",(e=>this.mouseClick(e))),e.append(r)})),e}chooseSymbol(e){const[t,s]=[this.properties.lang,`${this.properties.lang}Shift`],r=this.layouts[t][this.layouts.en.indexOf(e)];let a=this.properties.isCapsLock?r.toUpperCase():r;return this.properties.isShiftPressed&&(a=this.layouts[s][this.layouts.en.indexOf(e)]),this.properties.isCapsLock&&this.properties.isShiftPressed?a.toLowerCase():a}reLoadKeys(e){e.forEach((e=>{const t=e;t.textContent=this.chooseSymbol(t.dataset.key)})),this.properties.isLangSwitched&&(this.properties.isLangSwitched=!this.properties.isLangSwitched)}mouseClick(e){const t=e.currentTarget.dataset.key,s=this.elements.textarea;let r=s.selectionStart+1,[a,i,n]=[this.chooseSymbol(t),s.selectionStart,s.selectionEnd];switch(t){case"del":[a,n]=["",s.selectionEnd+1];break;case"backspace":[a,i]=["",s.selectionStart-1];break;case"enter":a="\n";break;case"tab":a="\t";break;case"spacebar":a=" ";break;case"capslock":e.currentTarget.classList.toggle("pressed"),[a,r]=["",s.selectionStart],this.capsLockOn();break;case"rightshift":case"leftshift":[a,r]=["",s.selectionStart],this.shiftKeyOn(e.currentTarget);break;case"leftctrl":case"rightctrl":e.currentTarget.classList.toggle("pressed"),this.properties.isCtrlPressed=!this.properties.isCtrlPressed,[a,r]=["",s.selectionStart];break;case"leftalt":case"rightalt":e.currentTarget.classList.toggle("pressed"),this.properties.isAltPressed=!this.properties.isAltPressed,[a,r]=["",s.selectionStart];break;case"win":[a,r]=["",s.selectionStart];break;case"uparrow":a="∧";break;case"downarrow":a="∨";break;case"leftarrow":a="<";break;case"rightarrow":a=">"}i>=0&&s.setRangeText(a,i,n),"del"!==t&&"backspace"!==t||(r=s.selectionStart),"leftshift"!==t&&"rightshift"!==t&&"capslock"!==t&&this.properties.isShiftPressed&&this.shiftKeyOn(),this.properties.isCtrlPressed&&this.properties.isAltPressed&&this.switchLang(),this.elements.textarea.focus(),this.elements.textarea.selectionStart=r}capsLockOn(){this.properties.isCapsLock=!this.properties.isCapsLock;const e=this.elements.keyboardContainer.querySelectorAll(".symbol");this.reLoadKeys(e)}shiftKeyOn(e=null){this.properties.isShiftPressed=!this.properties.isShiftPressed;const t=this.elements.keyboardContainer.querySelectorAll(".shift"),s=this.elements.keyboardContainer.querySelectorAll(".symbol");this.properties.isShiftPressed?null!==e&&e.classList.add("pressed"):t.forEach((e=>e.classList.remove("pressed"))),this.reLoadKeys(s)}switchLang(){this.properties.isLangSwitched=!this.properties.isLangSwitched,this.properties.lang="ru"===this.properties.lang?"en":"ru";const e=this.elements.keyboardContainer.querySelectorAll(".symbol");console.log("test"),this.reLoadKeys(e),this.properties.isCtrlPressed=!1,this.properties.isAltPressed=!1}render(){document.body.prepend(this.elements.main),this.elements.main.appendChild(this.elements.textarea),this.elements.main.appendChild(this.elements.keyboardContainer),this.elements.keyboardContainer.appendChild(this.createKeys())}toString(){return this.properties}}).init()})();